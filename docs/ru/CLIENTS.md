# Руководство по настройке клиентов

**Русский** | [English](../en/CLIENTS.md)

## Содержание
- [Об AmneziaWG](#об-amneziawg)
- [Поддерживаемые платформы](#поддерживаемые-платформы)
- [Установка клиента Amnezia](#установка-клиента-amnezia)
- [Импорт конфигурации](#импорт-конфигурации)
- [Инструкции для платформ](#инструкции-для-платформ)
- [Устранение неполадок](#устранение-неполадок)

## Об AmneziaWG

**AmneziaWG** — это улучшенная версия WireGuard с дополнительными функциями обфускации трафика:

- **Основан на WireGuard**: Та же быстрая, безопасная криптография
- **Обфускация трафика**: Затрудняет обнаружение и блокировку VPN
- **Устойчивость к DPI**: Обходит глубокую проверку пакетов
- **Совместимость**: На некоторых платформах использует стандартный клиент WireGuard

### Когда использовать AmneziaWG

✅ **Используйте AmneziaWG когда:**
- В странах с блокировкой VPN (Китай, Иран, Россия и т.д.)
- Провайдер замедляет VPN трафик
- Нужна максимальная устойчивость к цензуре

⚠️ **Используйте стандартный WireGuard когда:**
- Нет проблем с цензурой/блокировкой
- Нужна максимальная производительность
- Предпочитаете более простую настройку

## Поддерживаемые платформы

| Платформа | Клиент | Статус |
|----------|--------|--------|
| **Android** | AmneziaVPN | ✅ Рекомендуется |
| **iOS** | AmneziaVPN | ✅ Рекомендуется |
| **Windows** | AmneziaVPN | ✅ Рекомендуется |
| **macOS** | AmneziaVPN | ✅ Рекомендуется |
| **Linux** | amneziawg-tools | ✅ Командная строка |

## Установка клиента Amnezia

### Android

**Способ 1: Google Play (рекомендуется)**
1. Откройте [Google Play Store](https://play.google.com/store/apps/details?id=org.amnezia.vpn)
2. Найдите "AmneziaVPN"
3. Нажмите "Установить"
4. Откройте приложение после установки

**Способ 2: Прямая загрузка APK**
```bash
# С официального GitHub:
# https://github.com/amnezia-vpn/amnezia-client/releases

# Скачайте последний .apk файл
# Включите "Установка из неизвестных источников" в настройках
# Установите APK
```

### iOS

1. Откройте [App Store](https://apps.apple.com/app/amneziavpn/id1600529900)
2. Найдите "AmneziaVPN"
3. Нажмите "Загрузить"
4. Подтвердите через Face ID/Touch ID
5. Откройте приложение после установки

### Windows

**Загрузка с официального сайта:**

1. Перейдите на [https://amnezia.org/](https://amnezia.org/)
2. Нажмите "Скачать" → Выберите "Windows"
3. Запустите установочный `.exe` файл
4. Следуйте инструкциям мастера установки
5. Запустите AmneziaVPN из меню Пуск

**Или скачайте с GitHub:**
```powershell
# Посетите: https://github.com/amnezia-vpn/amnezia-client/releases
# Скачайте: AmneziaVPN_x.x.x_windows_x64.exe
```

### macOS

**Способ 1: Официальный сайт**
1. Посетите [https://amnezia.org/](https://amnezia.org/)
2. Нажмите "Скачать" → Выберите "macOS"
3. Откройте файл `.dmg`
4. Перетащите AmneziaVPN в папку "Программы"
5. Запустите из папки "Программы"

**Способ 2: Homebrew**
```bash
brew install --cask amneziavpn
```

### Linux (Ubuntu/Debian)

**Установка amneziawg-tools (командная строка):**

```bash
# Добавить репозиторий Amnezia
sudo add-apt-repository ppa:amnezia/ppa
sudo apt update

# Установить amneziawg
sudo apt install amneziawg amneziawg-tools

# Проверить установку
awg --version
```

**Или использовать GUI клиент:**
```bash
# Скачать .AppImage с GitHub
wget https://github.com/amnezia-vpn/amnezia-client/releases/download/vX.X.X/AmneziaVPN_x.x.x_linux_amd64.AppImage

# Сделать исполняемым
chmod +x AmneziaVPN_*.AppImage

# Запустить
./AmneziaVPN_*.AppImage
```

## Импорт конфигурации

### Способ 1: QR код (Мобильные устройства)

**На сервере:**
1. Подключитесь к VPN (если UI заблокирован)
2. Откройте `http://10.8.0.1:8888` в браузере
3. Войдите с учетными данными из скрипта установки
4. Нажмите "Add Client" → Введите имя
5. Нажмите "Show QR Code"

**На мобильном устройстве:**
1. Откройте приложение AmneziaVPN
2. Нажмите "+" или "Добавить подключение"
3. Выберите "Сканировать QR код"
4. Направьте камеру на QR код на экране
5. Подключение импортируется автоматически

### Способ 2: Файл конфигурации (Настольные ПК)

**На сервере:**
1. Подключитесь к VPN или временно откройте UI
2. Перейдите на `http://10.8.0.1:8888`
3. Нажмите "Add Client" → Введите имя
4. Нажмите "Download Config"
5. Сохраните `.conf` файл (например, `laptop-client.conf`)

**На компьютере:**

**AmneziaVPN GUI:**
1. Откройте AmneziaVPN
2. Нажмите "Добавить сервер"
3. Выберите "Импортировать из файла"
4. Выберите `.conf` файл
5. Нажмите "Импортировать"

**Linux командная строка:**
```bash
# Скопировать конфиг в /etc/amneziawg/
sudo cp laptop-client.conf /etc/amneziawg/awg0.conf

# Запустить туннель
sudo awg-quick up awg0

# Проверить
sudo awg show
ip addr show awg0

# Остановить туннель
sudo awg-quick down awg0
```

## Инструкции для платформ

### Android подробная настройка

1. **Установите AmneziaVPN** из Play Store
2. **Откройте приложение** → Нажмите "Добавить подключение"
3. **Сканируйте QR код** из веб-интерфейса
4. **Назовите подключение** (например, "Домашний VPN")
5. **Настройте опции:**
   - Автоподключение: ВКЛ (опционально)
   - Kill switch: ВКЛ (рекомендуется)
6. **Нажмите "Подключиться"**
7. **Разрешите VPN** при запросе
8. **Проверьте подключение:**
   - Иконка ключа в строке состояния
   - Посетите [https://whatismyipaddress.com/](https://whatismyipaddress.com/)
   - IP должен совпадать с вашим VPN сервером

**Оптимизация батареи:**
```
Настройки → Приложения → AmneziaVPN → Батарея
→ Установите "Без ограничений" чтобы избежать отключений
```

### iOS подробная настройка

1. **Установите AmneziaVPN** из App Store
2. **Откройте приложение** → Нажмите "+"
3. **Сканируйте QR код** или импортируйте файл
4. **Назовите профиль** (например, "Мой сервер")
5. **Нажмите "Добавить VPN конфигурацию"**
6. **Face ID/Touch ID** для авторизации
7. **Включите подключение** переключателем
8. **Проверьте:** Иконка VPN в строке состояния

**Always-On VPN (iOS 15+):**
```
Настройки → Основные → VPN и управление устройством
→ VPN → Подключение по требованию → Включить
```

### Windows подробная настройка

1. **Установите AmneziaVPN** (см. выше)
2. **Запустите приложение**
3. **Нажмите "Добавить сервер"**
4. **Выберите способ импорта:**
   - "Импорт из файла" → Выберите `.conf`
   - "Сканировать QR код" → Используйте камеру телефона
5. **Нажмите "Подключиться"**
6. **Разрешите в брандмауэре** если запросит
7. **Проверьте подключение:**
   - Зеленая галочка в приложении
   - Посетите [ipinfo.io](https://ipinfo.io)

### macOS подробная настройка

1. **Установите AmneziaVPN** (см. выше)
2. **Откройте из Программ**
3. **Предоставьте разрешения:**
   - Системные настройки → Защита и безопасность
   - Разрешите "AmneziaVPN" изменять настройки сети
4. **Импортируйте конфигурацию:**
   - Перетащите `.conf` файл в окно приложения
   - ИЛИ: Файл → Импортировать конфигурацию
5. **Нажмите "Подключиться"**
6. **Введите пароль** при запросе (пароль пользователя macOS)
7. **Проверьте:** В строке меню отображается статус VPN

### Linux командная строка

**Использование awg-quick:**

```bash
# 1. Скопировать конфиг с сервера
scp -P 9722 admino@SERVER_IP:~/client.conf ~/client.conf

# 2. Установить (если еще не сделано)
sudo apt install amneziawg amneziawg-tools

# 3. Переместить в системную директорию
sudo cp ~/client.conf /etc/amneziawg/awg0.conf
sudo chmod 600 /etc/amneziawg/awg0.conf

# 4. Запустить VPN
sudo awg-quick up awg0

# 5. Проверить
sudo awg show
# Должно показать интерфейс, peer, последний handshake

# Тест подключения
ping 10.8.0.1
curl https://ipinfo.io/ip
# Должно показать IP VPN сервера

# 6. Остановить VPN
sudo awg-quick down awg0
```

**Автозапуск при загрузке:**

```bash
# Включить systemd сервис
sudo systemctl enable awg-quick@awg0.service
sudo systemctl start awg-quick@awg0.service

# Проверить статус
systemctl status awg-quick@awg0
```

## Расширенная настройка

### Split Tunneling (раздельное туннелирование)

**Направлять через VPN только определенный трафик:**

Отредактируйте `.conf` файл:
```ini
[Interface]
PrivateKey = ...
Address = 10.8.0.2/32

[Peer]
PublicKey = ...
Endpoint = SERVER_IP:54321
# Только рабочая сеть через VPN:
AllowedIPs = 192.168.1.0/24, 10.0.0.0/8
# НЕ: 0.0.0.0/0
```

### Настройка DNS

**Использовать пользовательские DNS серверы:**

```ini
[Interface]
PrivateKey = ...
Address = 10.8.0.2/32
# Cloudflare DNS:
DNS = 1.1.1.1, 1.0.0.1
# ИЛИ Google DNS:
# DNS = 8.8.8.8, 8.8.4.4
# ИЛИ Яндекс DNS:
# DNS = 77.88.8.8, 77.88.8.1
```

### Постоянство подключения

**Keepalive для прохождения NAT:**

```ini
[Peer]
...
PersistentKeepalive = 25
# Отправлять keepalive каждые 25 секунд
# Предотвращает таймаут NAT (обычно 30-60с)
```

## Устранение неполадок

### Подключение не удается

**Симптомы:** "Handshake failed" или таймаут

**Решения:**

1. **Проверьте доступность сервера:**
   ```bash
   ping YOUR_SERVER_IP
   nc -zvu YOUR_SERVER_IP 54321
   ```

2. **Проверьте брандмауэр сервера:**
   ```bash
   # На сервере:
   sudo ufw status | grep 54321
   # Должно быть: 54321/udp ALLOW Anywhere
   ```

3. **Проверьте конфигурацию:**
   - IP Endpoint правильный?
   - Порт 54321 правильный?
   - Ключи скопированы правильно?

### Подключен, но нет интернета

**Симптомы:** VPN показывает подключение, но сайты не загружаются

**Решения:**

1. **Проблема с DNS:**
   ```ini
   # Добавьте DNS в конфиг:
   [Interface]
   DNS = 1.1.1.1
   ```

2. **Проблема с маршрутизацией:**
   ```bash
   # На клиенте (Linux):
   ip route show
   # Должно быть: default dev awg0
   
   # Если нет, перезапустите:
   sudo awg-quick down awg0
   sudo awg-quick up awg0
   ```

### Медленная скорость

**Оптимизации:**

1. **Настройка MTU:**
   ```ini
   [Interface]
   MTU = 1420
   # Попробуйте: 1380, 1340 если все еще медленно
   ```

2. **Проверьте CPU сервера:**
   ```bash
   # На сервере:
   htop
   # Если CPU загружен на 100%, обновите сервер
   ```

### Частые разрывы

**Решения:**

1. **Увеличьте keepalive:**
   ```ini
   [Peer]
   PersistentKeepalive = 15
   # Попробуйте: 15, 10, 5
   ```

2. **Отключите оптимизацию батареи (мобильные):**
   - Android: Настройки → Батарея → Без ограничений
   - iOS: Не должно быть проблемой

## Безопасность

### Защита файлов конфигурации

**Настольные ПК:**
```bash
# Ограничить права доступа:
chmod 600 ~/vpn-config.conf

# Зашифровать если хранить в облаке:
gpg --symmetric --cipher-algo AES256 vpn-config.conf
# Храните: vpn-config.conf.gpg
# Удалите оригинал: shred -vfz vpn-config.conf
```

**Мобильные:**
- Не делайте скриншоты QR кодов
- Удаляйте скачанные конфиги после импорта
- Используйте шифрование устройства

### Отзыв скомпрометированных клиентов

**Если устройство потеряно/украдено:**

1. **Зайдите в веб UI** с другого VPN-подключенного устройства
2. **Перейдите в список клиентов**
3. **Нажмите "Delete"** на скомпрометированном клиенте
4. **Подтвердите удаление**

## Дополнительные ресурсы

- [Официальный сайт AmneziaVPN](https://amnezia.org/)
- [AmneziaWG на GitHub](https://github.com/amnezia-vpn/amneziawg)
- [Документация WireGuard](https://www.wireguard.com/quickstart/)
- [Устранение неполадок](TROUBLESHOOTING.md)
